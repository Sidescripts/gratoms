<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin — Balance Control</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #0a0a0f;
      --surface:   #11111a;
      --border:    #1e1e2e;
      --accent:    #00e5a0;
      --accent2:   #ff4d6d;
      --text:      #e8e8f0;
      --muted:     #5a5a78;
      --card:      #13131f;
      --glow:      rgba(0, 229, 160, 0.15);
      --glow2:     rgba(255, 77, 109, 0.15);
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Mono', monospace;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 48px 16px;
      overflow-x: hidden;
    }

    body::before, body::after { /* your background effects */ 
      content: '';
      position: fixed;
      inset: 0;
      background-image: linear-gradient(rgba(0,229,160,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0,229,160,0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    body::after {
      top: -200px; right: -200px;
      width: 600px; height: 600px;
      background: radial-gradient(circle, rgba(0,229,160,0.06) 0%, transparent 70%);
    }

    .wrapper { position: relative; z-index: 1; width: 100%; max-width: 540px; }

    /* ==================== ALL YOUR ORIGINAL STYLES (unchanged) ==================== */
    .header { margin-bottom: 40px; animation: fadeDown 0.6s ease both; }
    .header-label { font-size: 11px; letter-spacing: 0.2em; color: var(--accent); text-transform: uppercase; margin-bottom: 8px; }
    .header h1 { font-family: 'Syne', sans-serif; font-size: clamp(28px, 5vw, 40px); font-weight: 800; line-height: 1.1; }
    .header h1 span { color: var(--accent); }
    .header p { margin-top: 10px; font-size: 13px; color: var(--muted); line-height: 1.6; }

    .tabs { display: grid; grid-template-columns: 1fr 1fr; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 4px; margin-bottom: 28px; }
    .tab-btn { padding: 12px; border: none; background: transparent; border-radius: 8px; font-family: 'Syne', sans-serif; font-size: 14px; font-weight: 700; letter-spacing: 0.05em; cursor: pointer; transition: all 0.25s ease; color: var(--muted); }
    .tab-btn.add.active { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--glow); }
    .tab-btn.sub.active { background: var(--accent2); color: #fff; box-shadow: 0 0 20px var(--glow2); }

    .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 32px; animation: fadeUp 0.6s 0.2s ease both; position: relative; overflow: hidden; }
    .card.add-mode::before { opacity: 1; background: linear-gradient(90deg, transparent, var(--accent), transparent); }
    .card.sub-mode::before { opacity: 1; background: linear-gradient(90deg, transparent, var(--accent2), transparent); }

    .field { margin-bottom: 20px; }
    label { display: block; font-size: 11px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; }
    input, select { width: 100%; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 14px 16px; font-family: 'DM Mono', monospace; font-size: 14px; color: var(--text); outline: none; }
    input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,229,160,0.08); }
    .sub-mode input:focus, .sub-mode select:focus { border-color: var(--accent2); box-shadow: 0 0 0 3px rgba(255,77,109,0.08); }

    .asset-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .asset-btn { padding: 12px 8px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; color: var(--muted); font-size: 13px; font-weight: 500; cursor: pointer; text-align: center; }
    .asset-btn.selected { border-color: var(--accent); color: var(--accent); background: rgba(0,229,160,0.06); }
    .sub-mode .asset-btn.selected { border-color: var(--accent2); color: var(--accent2); }

    .amount-wrap { position: relative; }
    .amount-prefix { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--muted); }
    .amount-wrap input { padding-left: 32px; }

    .btn { width: 100%; padding: 16px; border: none; border-radius: 10px; font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700; letter-spacing: 0.08em; cursor: pointer; margin-top: 8px; }
    .btn-add { background: var(--accent); color: #000; box-shadow: 0 4px 24px rgba(0,229,160,0.3); }
    .btn-sub { background: var(--accent2); color: #fff; box-shadow: 0 4px 24px rgba(255,77,109,0.3); }
    .btn.loading .spinner { display: block; }
    .btn.loading .btn-text { display: none; }

    .toast { position: fixed; bottom: 32px; left: 50%; transform: translateX(-50%) translateY(20px); background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 14px 24px; font-size: 13px; display: flex; align-items: center; gap: 10px; opacity: 0; transition: all 0.35s ease; z-index: 100; }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast.success { border-color: var(--accent); }
    .toast.error { border-color: var(--accent2); }

    .log-section { margin-top: 28px; }
    .log-item { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 12px 14px; display: flex; justify-content: space-between; font-size: 12px; }
    .log-amount.add { color: var(--accent); }
    .log-amount.sub { color: var(--accent2); }
  </style>
</head>
<body>

<div class="wrapper">

  <div class="header">
    <div class="header-label">// admin panel</div>
    <h1>Balance <span>Control</span></h1>
    <p>Manually adjust user crypto balances. All changes are permanent and logged.</p>
  </div>

  <div class="tabs">
      <button class="tab-btn add active" onclick="switchTab('add')">＋ Add Balance</button>
      <button class="tab-btn sub" onclick="switchTab('sub')">－ Subtract Balance</button>   
  </div>

  <div class="card add-mode" id="card">
    <div class="field">
      <label>Username</label>
      <input type="text" id="username" placeholder="e.g. Tuga" autocomplete="off" />
    </div>

    <div class="field">
      <label>Asset</label>
      <div class="asset-grid">
        <button class="asset-btn selected" data-asset="USDT" onclick="selectAsset(this)"><span class="asset-icon">₮</span>USDT</button>
        <button class="asset-btn" data-asset="BTC" onclick="selectAsset(this)"><span class="asset-icon">₿</span>BTC</button>
        <button class="asset-btn" data-asset="ETH" onclick="selectAsset(this)"><span class="asset-icon">Ξ</span>ETH</button>
      </div>
    </div>

    <div class="field">
      <label>Amount</label>
      <div class="amount-wrap">
        <span class="amount-prefix">#</span>
        <input type="number" id="amount" placeholder="0.00" min="0" step="any" />
      </div>
    </div>

    <div class="divider"></div>

    <button class="btn btn-add" id="submitBtn" onclick="handleSubmit()">
      <span class="btn-text" id="btnText">ADD BALANCE</span>
      <span class="spinner"></span>
    </button>
  </div>

  <div class="log-section">
    <div class="log-header">
      <span class="log-title">// recent actions</span>
      <button class="log-clear" onclick="clearLog()">clear</button>
    </div>
    <div class="log-list" id="logList">
      <div class="log-empty" id="logEmpty">No actions yet</div>
    </div>
  </div>

</div>

<!-- Toast -->
<div class="toast" id="toast">
  <span class="toast-dot"></span>
  <span id="toastMsg"></span>
</div>
<script>
    // Just initialize once DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        renderLog();           // if you want initial empty log
        // Optional: focus username field
        document.getElementById('username')?.focus();
    });
</script>

<!-- <script>
// ====================== BALANCE CONTROL - SAME AS USERS.JS ======================
let currentTab = 'add';
let selectedAsset = 'USDT';
let actionLog = [];

function switchTab(tab) {
  currentTab = tab;
  const card = document.getElementById('card');
  const addBtn = document.querySelector('.tab-btn.add');
  const subBtn = document.querySelector('.tab-btn.sub');
  const submitBtn = document.getElementById('submitBtn');
  const btnText = document.getElementById('btnText');

  if (tab === 'add') {
    addBtn.classList.add('active'); subBtn.classList.remove('active');
    card.className = 'card add-mode';
    submitBtn.className = 'btn btn-add';
    btnText.textContent = 'ADD BALANCE';
  } else {
    subBtn.classList.add('active'); addBtn.classList.remove('active');
    card.className = 'card sub-mode';
    submitBtn.className = 'btn btn-sub';
    btnText.textContent = 'SUBTRACT BALANCE';
  }
}

function selectAsset(el) {
  document.querySelectorAll('.asset-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  selectedAsset = el.dataset.asset;
}

async function handleSubmit() {
  const username = document.getElementById('username').value.trim();
  const amount = document.getElementById('amount').value.trim();
  const btn = document.getElementById('submitBtn');

  if (!username) return showToast('Username is required', 'error');
  if (!amount || parseFloat(amount) <= 0) return showToast('Enter a valid amount', 'error');

  const isAdd = currentTab === 'add';
  const endpoint = isAdd ? '/api/v1/admin/add-balance' : '/api/v1/admin/subtract-balance';
  const actionWord = isAdd ? 'ADD' : 'SUBTRACT';

  btn.classList.add('loading');
  btn.disabled = true;

  try {
    const token = localStorage.getItem('token');
    if (!token) throw new Error("Please log in first");

    const res = await fetch(endpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        username: username,
        amount: parseFloat(amount),
        asset: selectedAsset.toLowerCase()
      })
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.message || "Request failed");
    }

    showToast(`${actionWord} successful!`, 'success');
    addToLog(username, selectedAsset, parseFloat(amount), isAdd ? 'add' : 'sub');
    document.getElementById('amount').value = '';

  } catch (err) {
    showToast(err.message || 'Failed to update balance', 'error');
  } finally {
    btn.classList.remove('loading');
    btn.disabled = false;
  }
}

// Log & Toast functions (your original beautiful ones)
function addToLog(username, asset, amount, type) {
  const entry = { username, asset, amount, type, time: new Date() };
  actionLog.unshift(entry);
  renderLog();
}

function renderLog() {
  const list = document.getElementById('logList');
  const empty = document.getElementById('logEmpty');
  if (actionLog.length === 0) {
    empty.style.display = 'block';
    list.innerHTML = '';
    return;
  }
  empty.style.display = 'none';
  list.innerHTML = '';
  actionLog.forEach(entry => {
    const sign = entry.type === 'add' ? '+' : '-';
    const cls = entry.type === 'add' ? 'add' : 'sub';
    const time = entry.time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const item = document.createElement('div');
    item.className = 'log-item';
    item.innerHTML = `
      <div class="log-left">
        <span class="log-user">@${entry.username}</span>
        <span class="log-time">${time}</span>
      </div>
      <div class="log-right">
        <span class="log-asset">${entry.asset}</span>
        <span class="log-amount ${cls}">${sign}${entry.amount}</span>
      </div>
    `;
    list.appendChild(item);
  });
}

window.clearLog = function() {
  actionLog = [];
  renderLog();
};

let toastTimer;
function showToast(msg, type = 'success') {
  const toast = document.getElementById('toast');
  const toastMsg = document.getElementById('toastMsg');
  toast.className = `toast ${type}`;
  toastMsg.textContent = msg;
  void toast.offsetWidth;
  toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toast.classList.remove('show'), 3500);
}

// Enter key
document.addEventListener('keydown', e => { if (e.key === 'Enter') handleSubmit(); });

// Initial render
renderLog();
</script> -->
<script src="../js/manipulation.js"></script>
</body>
</html>